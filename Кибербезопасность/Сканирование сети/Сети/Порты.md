### **Порты**

Порты могут быть не только открытыми или закрытыми. Из-за особенностей передачи пакетов и ответов на них разными протоколами для более точного определения состояния исследуемой цели nmap выделяет шесть состояний портов, их надо знать для понимания полученных результатов сканирования:

| Статус                             | Значение                                                                                                                                                            |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| открыт/open                        | Приложение принимает на порт пакет или запросы на соединение.                                                                                                       |
| закрыт/closed                      | Порт отвечает на запросы, но не используется никаким приложением.                                                                                                   |
| фильтруется/filtered               | Запросы не доходят до этого порта, а значит, невозможно определить, открыт он или нет.                                                                              |
| не фильтруется/unfiltered          | Порт доступен, но Nmap не может определить, закрыт он или открыт. Как правило, помогает использование другого способа сканирования.                                 |
| открыт-фильтруется / open-filtered | Не получается определить, открыт порт или фильтруется. Возникает, если открытый порт не отвечает. Как правило, помогает использование другого способа сканирования. |
| закрыт-фильтруется/closed-filtered | Не получается определить, закрыт порт или фильтруется. Как правило, помогает использование другого способа сканиров                                                 |
## Популярные Порты

1. **Сервисы**: 
   SSH (22)
   FTP (21)
   SMB/RPC (135/445)
   MSSQL (1433)
   PostgreSQL (5432)
   Redis (6379)
   Web (80,443)
   Alternative Web (8080,8443)
   etc…
2. **Маршруты трафика до узлов во внутренней сети компании:** 
   сканирование собственной локальной сети (172.16.0.0/12 или 192.168.0.0/16), сканирование локальной сети организации 10.0.0.0/8
3. **Доступные сервисы сетевого оборудования:** 
   Cisco Smart Install (4786)
   Web (80,443)
   Cisco UCS Director Express for Big Data + VNC (8787/ 599)
   SSH (22)
   Mikrotik Neighbor Discovery Protocol (5678)
   Winbox (8291)
   и пр.

На сетевых периметрах часто встречаются UDP-сервисы DNS (53), NTP (123), SNMP (161), VPN (500, 1194, 4500), RDG (3391). Реже встречаются сервисные службы типа echo (7), discard (9), chargen (19), а также DAYTIME (13), TFTP (69), SIP (5060), сервисы NFS (2049), RPC (111, 137-139, 761 и др.), СУБД (1434).  
  
**Расширенный список:**  
  
21 — ftp  
22 — ssh  
23 — telnet  
80, 8000, 8001, 8002, 8004, 8006, 8007, 8008, 8080, 8888 — http  
88 — kerberos  
139 — netbios  
143 — imap  
389 — ldap  
443, 8443, 9443 — https  
445 — smb  
623, 49152 — ipmi  
636 — ldaps  
873 — rsync  
1099 — websphere  
1433, 1434 — mssql  
1500 — tivoli_storage_manager  
1540, 1541 — 1С  
2001, 2010 — ibm_http  
2181 — zookeeper  
2222 — ansible  
2375, 2376 — docker  
2379 — k8s etcd  
2809, 9043, 9060, 9080, 9501, 9502, 9503 — websphere  
5558, 5559 — websphere_java_messaging_serevice  
7873 — websphere_rds_client  
8879 — websphere_soap  
3306 — mysql  
3389 — rdp  
4678 — cisco smart install  
4899 — radmin  
5800 — 5810,5900,5901 — vnc  
5432, 5433 — postgresql  
5555 — hp_data_protector  
5557 — citrix  
5666 — nagious  
8291 — mikrotik  
10050, 10051 — zabbix  
7001 — weblogic  
9000 — clickhouse  
27017, 27018 — mongodb  
50013 — sap  
1521 — 1527 — oracle  
3200 — 3299 — sap  
4786 — cisco_smart_install  
9200, 9300 — elasticsearch  
5985, 5986 — winrm  
50070 — hdfs_ui  
6443 — k8s  
8111 — click_house  
8500, 8501 — consul  
8200, 8201 — vault  
10250, 10255 — k8s

### Windows most ports
Сервисы, принадлежащие машинам Windows, которые **могут помочь в определении целей или компрометации системы:**

- _88 - kerberos (Kerberos Key Distribution Center)_ — наличие этого порта помогает определить контроллер домена в сети
- _135 - MSRPC (Microsoft RPC[6])_ — используется в приложениях «клиент-сервер» Microsoft (например, Exchange), позволяет выполнять различные операции в OS при наличии учетных данных
- _137 - NETBIOS-NS (NetBIOS Name Service)_ — позволяет узнать доменное имя машины и ее MAC адрес
- _389 - LDAP (Lightweight Directory Access Protocol)_ — этот порт может дать различные возможности, как по подбору учетных данных, так и по получению доступа к LDAP через эксплуатацию уязвимостей (пример [тут](https://www.rapid7.com/db/modules/auxiliary/admin/ldap/vmware_vcenter_vmdir_auth_bypass/))
- _445 - SMB (Server Message Blocks over IP)_ — протокол SMB имеет ряд уязвимостей и недостатков в различных версиях, которые могут приводить к выполнению кода, захвату пользовательской сессии, получению доступа к данным на файловых серверах
- _1433 - MSSQL (Microsoft SQL Server)_ — сервис MSSQL позволяет получить доступ к управлению БД и, что более важно, выполнить произвольный код на машине Windows, если у нас есть аккаунт для доступа к БД
- 3389 - _RDP (Remote Desktop Protocol)_ — служба удаленных рабочих столов также имеет в истории различные уязвимости, приводящие к выполнению произвольного кода (BlueKeep), и уязвима по отношению к атакам MiTM, позволяющим получить доступ к службе от имени жертвы

_На самом деле,_ публичных сервисов [куда больше](https://social.technet.microsoft.com/wiki/contents/articles/1772.windows-ports-protocols-and-system-services.aspx).

Пример команды для обнаружения узлов с ОС Windows:  
`nmap -Pn -n -sT -p 88,135,137,389,445,1433,3389 -sV -sC --open -iL list-of-machines.txt`