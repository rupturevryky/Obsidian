***
## SCAN TECHNIQUES
![[SCAN_TECHNIQUES.png]]
>#### **TCP Scan с использованием системного вызова connect (-sT)**
Например, стандартным типом является закрытие с соединением:
>- `sT` – это то самое сканирование, при котором соединение будет полностью открыто и закрыто валидным способом, как в ОС и задумывалось.

>#### **UDP Scan (-sU)**
Сканирование с помощь протокола **UDP**.
**Но имейте ввиду UDP протокол может достаточно быстро убить соединения - в нем нет контроля соединения.**

>#### **FIN Scan (-sF)**
**FIN Scan** – это, по сути, тоже Self сканирование, которое использует концепцию полуоткрытых портов. Оно не создает соединение как таковое, оно просто отправляет те запросы, которые содержат флаг **FIN**.
>- **Напоминалка про FIN**:
    >**FIN** - флаг, будучи установлен, указывает на завершение соединения

>#### **XMAS Scan (-sX)**
**XMAS Scan** – оно переключает каждый запрос новым флагом или, в зависимости от того, что у него сейчас генерируется, включается и флаг.
Другими словами суть в том, чтобы отправлять пакеты сразу с несколькими флагами.
>- устанавливаются **FIN**, **PSH** и **URG** флаги.
--- 
## HOST DISCOVERY
здесь указываются те функции, которые возможны для обнаружения хостов в сети.
![[HOST_DISCOVERY.png]]
![[Сканирование сети - основа#Типы сканирований и протоколы]]

***
## Методы сканирования:

**`––data-length <число>`** - добавить произвольные данные к посылаемым пакетам.
<details style="padding:10px">
    <summary style="cursor: pointer">Подробней</summary>
    
        В обычных условиях nmap посылает минимальные пакеты, содержащие только заголовок. Так, TCP пакеты составляют 40 байтов, а запросы на ICMP эхо-ответ — всего 28. Эта опция указывает nmap добавлять заданное число произвольных байтов к большинству посылаемых пакетов. Эта опция не влияет на пакеты, используемые для определения ОС (-O)
</details>

***
**Сканирование нескольких IP-адресов можно выполнить так:**

`nmap 192.168.0.1 192.168.0.2 192.168.0.3`

или так:

`nmap 192.168.0.1-20`

---

**Для сканирования всей подсети можно использовать такую команду:**

`nmap 192.168.0.*`

или так:

`nmap 192.168.0.0/24`

---

**При сканировании сетей можно пропускать некоторые IP-адреса:**

`nmap 192.168.0.0/24 --exclude 192.168.0.5,192.168.0.7,192.168.0.254`

---

**Список хостов для сканирование можно взять из файла (допустим, /tmp/testip.txt):**

`nmap -iL /tmp/testip.txt`

---

**Также из файла можно взять список исключений (допустим, /tmp/excludeip.txt):**

`nmap -iL /tmp/testip.txt --excludefile /tmp/excludeip.txt`

***

Определить ОС, установленную на хосте можно с помощью опции `-O`:

```
nmap -O 192.168.0.12
...
Device type: general purpose
Running: Linux 3.X
OS CPE: cpe:/o:linux:linux_kernel:3
OS details: Linux 3.11 - 3.14
Network Distance: 1 hop
...
```
***
Узнать версии запущенных сервисов на хосте можно используя опцию `-sV`:
```
nmap -sV 192.168.0.13

Starting Nmap 6.47 ( http://nmap.org ) at 2016-10-13 09:58 EEST
Nmap scan report for mars (192.168.0.13)
Host is up (0.0000070s latency).
Not shown: 985 closed ports
PORT     STATE SERVICE         VERSION
22/tcp   open  ssh             OpenSSH 6.7p1 Debian 5+deb8u2 (protocol 2.0)
80/tcp   open  http            Apache httpd 2.4.10 ((Debian))
139/tcp  open  netbios-ssn     Samba smbd 3.X (workgroup: MARS)
445/tcp  open  netbios-ssn     Samba smbd 3.X (workgroup: MARS)
3306/tcp open  mysql           MySQL 5.5.49-0+deb8u1-log
...
```
***
**Осуществить быстрое сканирование:**

`nmap -F 192.168.0.1`

---

**Показать открытые порты на сканируемом узле:**

`nmap --open 192.168.0.1`

---

**Отобразить отправленные/полученные пакеты:**

`nmap --packet-trace 192.168.0.1`

---
Вывести сетевые интерфейсы и маршруты хоста, с которого выполняется сканирование (весьма полезно для отладки):
```
nmap --iflist

Starting Nmap 6.47 ( http://nmap.org ) at 2016-10-13 10:04 EEST
************************INTERFACES************************
DEV      (SHORT)    IP/MASK                     TYPE     UP   MTU   MAC
eth0.101 (eth0.101) 192.168.2.13/24             ethernet up   1500  00:0C:29:8A:AC:3E
eth0.101 (eth0.101) fe80::20c:29ff:fe8a:ac3e/64 ethernet up   1500  00:0C:29:8A:AC:3E
eth0     (eth0)     192.168.0.13/23             ethernet up   1500  00:0C:29:8A:AC:3E
eth0     (eth0)     fe80::20c:29ff:fe8a:ac3e/64 ethernet up   1500  00:0C:29:8A:AC:3E
eth1     (eth1)     (none)/0                    ethernet down 1500  00:0C:29:8A:AC:48
lo       (lo)       127.0.0.1/8                 loopback up   65536
lo       (lo)       ::1/128                     loopback up   65536

**************************ROUTES**************************
DST/MASK                     DEV      METRIC GATEWAY
192.168.2.0/24               eth0.101 0
192.168.0.0/23               eth0     0
0.0.0.0/0                    eth0     0      192.168.0.15
::1/128                      lo       0
fe80::20c:29ff:fe8a:ac3e/128 lo       0
fe80::20c:29ff:fe8a:ac3e/128 lo       0
ff02::1/128                  eth0     0
::1/128                      lo       256
fe80::/64                    eth0     256
fe80::/64                    eth0.101 256
ff00::/8                     eth0     256
ff00::/8                     eth0.101 256
```
---
**Выполнить сканирование определенно порта можно несколькими способами, например так:**

```
nmap -p 80 192.168.0.1

Starting Nmap 6.47 ( <http://nmap.org> ) at 2016-10-13 10:07 EEST
Nmap scan report for astra (192.168.0.1)
Host is up (0.00028s latency).
PORT   STATE SERVICE
80/tcp open  http
MAC Address: E8:40:F2:3B:CB:98 (Pegatron)

Nmap done: 1 IP address (1 host up) scanned in 0.63 seconds
```

или так:
`nmap -p T:80 192.168.0.1`

---
**Можно также указывать для сканирование несколько портов через запятую:**

`nmap -p 80,443 192.168.0.1`

или задавать диапазон портов:

`nmap -p 80-200 192.168.0.1`

---
**Топ 5 портов можно увидеть так:**

```
nmap --top-ports 5 192.168.0.1

Starting Nmap 6.47 ( <http://nmap.org> ) at 2016-10-13 10:18 EEST
Nmap scan report for astra (192.168.0.1)
Host is up (0.00022s latency).
PORT    STATE  SERVICE
21/tcp  closed ftp
22/tcp  open   ssh
23/tcp  closed telnet
80/tcp  open   http
443/tcp open   https
MAC Address: E8:40:F2:3B:CB:98 (Pegatron)

Nmap done: 1 IP address (1 host up) scanned in 1.63 seconds
```

---

**Выполнить сканирование узла используя TCP ACK (PA) и TCP Syn (PS):**

`nmap -PS 192.168.0.1`

`nmap -p 80,443 -PS 192.168.0.1`

`nmap -PA 192.168.0.1`

`nmap -PA 80,200-400 192.168.0.1`

---

**Сканировать хост с использованием IP ping:**

`nmap -PO 192.168.0.1`

---

**Сканировать хост с использованием UDP ping:**

`nmap -PU 192.168.0.1`
***
## Скрипты в nmap (-sC)

существует несколько способов запуска скриптов:

1. Cпособо который запускает **дефолтные скрипты** - в nmap есть такое понятие как дефолтные скрипты - это отдельная категория скриптов которые запускаются одной командой и их не надо вводить каждый лично и отдельно запускать.
    
2. Второй способ - запуск **конкретного скрипта**, скрипты которые устанавливаются вместе с nmap по умолчанию лежат в папке: `usr/share/nmap/scripts`
    
    ![[Список скриптов nmap.png]]
    
    Тут можно посмотреть перечь скриптов, пополнить их кастомными из опенсурса, открыть их на редактирование в случае необходимости (некоторые скрипты отрабатывают в ошибкой и их приходится допиливать, большая часть скриптов которые тут есть, пишется комьюнити nmap, очень мало скриптов написано разработчиками).
    
    Более подробно про скрипты можете почитать **[тут](https://networkguru.ru/nmap-scripting-engine-rukovodstvo/)** и **[тут](https://xakep.ru/2016/02/25/pimp-my-nmap/)**