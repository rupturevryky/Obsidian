# Введение

**OpenVAS (Open Vulnerability Assessment System)** — это мощный бесплатный инструмент с открытым исходным кодом для сканирования уязвимостей и анализа безопасности сетей и систем с целью обнаружения уязвимостей. Это одна из самых популярных альтернатив коммерческим решениям.

Он используется для обнаружения потенциальных уязвимостей в компьютерных системах, сетевых устройствах и приложениях, позволяя администраторам и этичным хакерам оценивать уровень безопасности инфраструктуры.

- **OpenVAS** основан на исходном коде [Nessus](https://spy-soft.net/nessus-kali-linux/), но с момента выхода его первой версии произошли значительные изменения, и теперь сканер предоставляет свой собственный набор функций.
- Инструмент разрабатывается и продвигается компанией **Greenbone** с 2006 года. Являясь частью коммерческого семейства продуктов для управления уязвимостями **Greenbone Enterprise Appliance**, сканер входит в состав продукта **Greenbone Community Edition** вместе с другими модулями с открытым исходным кодом.
- **OpenVAS** использует большую базу данных сигнатур уязвимостей и, что более важно, регулярно ее обновляет, что позволяет своевременно обнаруживать слабые места в инфраструктуре.
- Продукт обладает большим потенциалом масштабируемости, то есть может сканировать большие сети и работать со многими устройствами одновременно, что значительно облегчает его использование при работе с большими системами.
- **OpenVAS** имеет множество настроек, гибкую конфигурацию и поддерживает значительное количество плагинов, в том числе пользовательских.
- Еще одна полезная функция — создание подробных отчетов о найденных уязвимостях, включающих их описание, возможные риски и предложения по их устранению. Отчеты можно экспортировать в различные форматы.

После выпуска **OpenVAS** версии **9.0** фреймворк был переименован в **Greenbone Vulnerability Management (GVM)** и выпущен как **Greenbone Source Edition (GSE)**. Начиная с **GVM 10** термин **OpenVAS** используется только для компонента сканера.

OpenVAS имеет три сервиса:

- **Сервис сканирования** — отвечает за анализ уязвимостей.
- **Сервис менеджера** — выполняет задачи, такие как фильтрация или классификация результатов анализа. Этот сервис также используется для управления базами данных, содержащими настройки и функциональности администрирования пользователей, включая группы и роли.
- **Сервис клиента** — используется как графический веб-интерфейс для настройки OpenVAS и отображения полученных результатов или выполнения отчетов.

---

# Установка

---

## Установка OpenVAS (GVM) на Kali Linux

Вместо обычной установки, вы можете [установить OpenVAS в Docker](https://spy-soft.net/openvas-docker/). [[#Установка OpenVAS в Docker]]

Откройте терминал и обновите систему:
``` 
sudo apt update && sudo apt upgrade -y sudo apt autoremove
```
Убедитесь, что **haveged** запущен:
```
sudo ps aux | grep “have”
```
![[Кибербезопасность/Сканирование сети/Сканирование уязвимостей/assets/openVAS.png]]
Начните установку **OpenVAS (GVM)**:
```
sudo apt install openvas -y
```

Проверьте работу сервиса **Redis**, который устанавливается вместе с **OpenVAS**:
```
sudo systemctl status redis-server@openvas.service
```
![[Pasted image 20240629101722.png]]
Запустите службу, если она не запущена:
```
sudo systemctl start redis-server@openvas.service
```
Включите запуск службы при запуске:
```
sudo systemctl enable redis-server@openvas.service
```
![[Pasted image 20240629101733.png]]
Проверьте запущен ли **Redis**:
```
sudo systemctl status redis-server@openvas.service
```
![[Pasted image 20240629101823.png]]
Запустите настройку **gvm**:
```
sudo gvm-setup
```
Команда должна создать пользователя для **openvas/gvm**. Сохраните этот пароль!
![[Pasted image 20240629101900.png]]
Проверьте правильность настройки:
```
sudo gvm-check-setup
```
![[Pasted image 20240629101934.png]]
Обновите каналы (это займет некоторое время):
```
sudo gvm-feed-update
```
Запустите gvmd и ospd-openvas:
```
sudo systemctl status gvmd ospd-openvas
```
![[Pasted image 20240629102010.png]]

---

### Траблшутинг 

Если не работает, попробуйте выполнить команду:
```
sudo systemctl start gvmd ospd-openvas
```
Теперь снова включите:
```
sudo systemctl enable gvmd ospd-openvas
```
Еще раз проверьте статус gvmd и ospd-openvas:
```
sudo systemctl status gvmd ospd-openvas
```
![[Pasted image 20240629102054.png]]
Включите помощника по безопасности **greenbone**:
```
sudo systemctl enable greenbone-security-assistant
```
![[Pasted image 20240629102116.png]]

---

## Установка OpenVAS в Docker

Самый быстрый способ установить **OpenVAS** — использовать Docker. Сначала нужно установить **Docker** и **Docker Compose**. Оба инструмента можно установить с помощью следующей команды:
``` 
sudo apt install docker.io docker-compose
```
Нам понадобиться файл [docker-compose.yml](https://greenbone.github.io/docs/latest/22.4/container/index.html "docker-compose.yml"), который создаст образы и запустит необходимые контейнеры для развертывания приложения.
![[Pasted image 20240629103531.png]]
Его можно скачать с помощью команды:
```
curl -f -L https://greenbone.github.io/docs/latest/_static/docker-compose-22.4.yml -o docker-compose.yml
```
После загрузки файла можно запустить необходимые контейнеры:
```
docker-compose -f $DOWNLOAD_DIR/docker-compose.yml -p greenbone-community-edition up -d
```

---

### Другой вариант установки сервера OpenVAS

Другой вариант установки сервера **OpenVAS** на локальный компьютер — использовать [образ Docker](https://immauss.github.io/openvas "образ Docker"). Если у вас установлен **Docker**, достаточно загрузить образ и выполнить команду для запуска сервисов в разных контейнерах:
```
docker run --detach --publish 9392:9392 -e PASSWORD="Ваш пароль администратора здесь" --volume openvas:/data --name openvas immauss/openvas
```
После завершения настройки запустятся все необходимые процессы **OpenVAS** и автоматически откроется веб-интерфейс.

Можно проверить работу контейнера, с помощью команды:
```
docker ps
```
![[Pasted image 20240629103944.png]]
Веб-интерфейс работает локально на порту **9392** с **SSL** и доступен по адресу: `https://localhost:9392`.
OpenVAS также настроит учетную запись и автоматически сгенерирует пароль.

Используя графический интерфейс пользователя (GUI), вы можете войти под именем администратора и паролем, сгенерированным во время первоначальной настройки.
![[Pasted image 20240629104042.png]]
После входа в веб-интерфейс вы будете перенаправлены в панель инструментов Greenbone Security Assistant.

---

# Использование OpenVAS (GVM) на Kali Linux

Чтобы войти в панель управления, откройте предпочитаемый браузер (я использую Firefox) и перейдите по адресу: `http://127.0.0.1:9392`

**Если у вас возникли проблемы с адресом**, попробуйте остановить и запустить заново. Также попробуйте перезапустить систему, а затем используйте приведенные ниже команды. Процесс запуска может занять несколько минут:
```
sudo gvm-stop
sudo gvm-start
```
Браузер по умолчанию автоматически откроет для `openvas/gvm`.

В Firefox — нажмите «Дополнительно» —> «Принять риск и продолжить». Затем вы должны увидеть форму авторизации:
![[Pasted image 20240629102532.png]]
Войдите в систему с помощью логина и пароля, сгенерированного из **gvm-setup**.

Пароль должен выглядеть примерно так без **admin:**:
```
admin:423196df-8e8b-431c-9909–7f82ee82bdfe
```

---

### Сканирование

Перейдите в раздел **Scan** (Сканирование) —> **New task** (Новая задача). Добавьте новую цель и сохраните проект.
![[Pasted image 20240629102754.png]]
Нажмите кнопку воспроизведения, чтобы начать сканирование.
![[Pasted image 20240629102808.png]]
Через несколько минут, проверив отчет, вы должны увидеть результат сканирования. Если вы сканировали другую уязвимую машину, ваш результат будет отличаться.
![[Pasted image 20240629102831.png]]

---

# **OpenVAS** в **Metasploit**

Источник: [использование OpenVAS в Metasploit](https://spy-soft.net/openvas-metasploit/).

Прежде чем начать использовать **OpenVAS** в [Metasploit](https://spy-soft.net/how-to-use-metasploit/), нужно его установить (см. [[#Установка OpenVAS (GVM) на Kali Linux]]).

---

### Запуск **OpenVAS**

Проверьте работу службы **OpenVAS**:
```
openvas-start
```
![[Pasted image 20240629105208.png]]

---

### Загрузка **OpenVAS** в **Metasploit**

Запустите **Metasploit**:
```
msfconsole
```
Запустите **OpenVAS**:
```
load openvas
```
![[Pasted image 20240629105321.png]]

---

## Список команд **OpenVAS**


Откройте справку и изучите доступные команды **OpenVAS**:
```
openvas_help
```
![[Pasted image 20240629105355.png]]

---

### Подключение **OpenVAS**
Используя учетные данные, подключите **OpenVAS** к его сервису:
```
openvas_connect [имя пользователя] [пароль] [хост] [порт]
```
![[Pasted image 20240629105447.png]]

---

### Создание цели для поиска уязвимостей

Cоздайте цель для сканирования, для этого выполните (пример на картинке):
```
openvas_target_create "TargetName" IPOfTarget "NameOfScan - Comment"
```
В этом примере мой целевой IP-адрес — это намерено уязвимая виртуальная машина Lampiao с [Vulnhub](https://spy-soft.net/how-to-use-vulnhub/) с IP-адресом 192.168.56.101.

Обратите внимание, что все, что вы будете делать, также будет выполняться в самой базе данных OpenVAS. Следовательно, позже вы сможете открыть результаты в графическом веб-интерфейсе. В качестве примера можно привести скрин ниже, показывающий исходное сканирование Lampiao, которое мы только что создали, а также все другие сканирования, которые я ранее запускал с помощью OpenVAS.

Также обратите внимание на длинный идентификатор нашего недавно созданного скана. Нам это понадобится позже.
![[Pasted image 20240629105632.png]]

---

### Проверка доступных типов сканирования и списка целей
Чтобы узнать, какие типы сканирования доступны, запустите:
``` 
openvas_config_list
```
![[Pasted image 20240629105821.png]]
Команда отобразит все доступные конфиги сканирования. Их необходимо указать при создании **Task** (Задачи). Это те же самые конфиги сканирования, которые доступны через веб-интерфейс.

На этом этапе вы можете задаться вопросом, зачем использовать сканирование уязвимостей с помощью **Metasploit**, а не простой веб-интерфейс **OpenVAS**? Ответ: при работе с **Metasploit Workspaces** удобно хранить все в одном месте.

Если забыли идентификатор своей цели, можете получить эту информацию:
```
openvas_target_list
``` 
На следующем этапе нам понадобятся идентификаторы цели и конфигурации сканирования.

---

### Создание задачи

Создайте новую задачу **Task**:
```
openvas_task_create [название задачи] [описание] [идентификатор конфига] [идентификатор цели]
```
![[Pasted image 20240629110221.png]]
После создание задачи, она появится в списке со статусом **New** (Новая).

Чтобы получить идентификатор, снова откройте список задач:
```
openvas_task_list
```

---

## Поиск уязвимостей

Запустите задание:
```
openvas_task_start [идентификатор задачи]
```
![[Pasted image 20240629110325.png]]
Поиск уязвимости можно занять много времени, все зависит от количества выбранных целей и уровня интенсивности.

---

### Проверка статуса задачи

Чтобы проверить статус задачи, выполните команду:
```
openvas_task_list
```
![[Pasted image 20240629110357.png]]
Процесс поиска уязвимостей можно увидеть в столбике **Progess** (Прогресс). Как только оно станет равным **-1**, сканирование будет завершено. Просто повторите команду, несколько раз нажав клавишу со стрелкой вверх, пока она не завершится.

---

## Создание отчета

Как только сканирование завершится, есть несколько способов создать отчет. НО удобнее изучать отчёт в веб-интерфейсе.

Чтобы отобразить список отчетов:
```
openvas_report_list
```
![[Pasted image 20240629110503.png]]
Теперь можно выбрать, в каком формате экспортировать отчет:
```
openvas_format_list
```
![[Pasted image 20240629110520.png]]

---

### Экспорт отчета

Чтобы экспортировать отчет, выберите нужный формат и выполните команду:
```
openvas_report_download [идентификатор отчета] [идентификатор формата] [путь для сохранения отчета] [имя отчета]
```
![[Pasted image 20240629110558.png]]
Но как сказано ранее веб-интерфейс работает намного лучше.

---

### Команды
**Поменять администраторский пароль:**

```
gvmd --user=admin --new-password=passwd;
```

Или можно создать дополнительных пользователей **OpenVAS**: запустите `gvmd` с параметром `--create-user`, который добавит нового пользователя и отобразит случайно сгенерированный пароль:

```
gvmd --create-user=test 
User created with password 'yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyy'. 

root@kali:~# gvmd --get-users 
admin 
test
```

---