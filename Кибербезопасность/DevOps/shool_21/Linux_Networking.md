## Part 1. Инструмент **ipcalc**

#### 1.1. Сети и маски

1. Адрес сети `192.167.38.54/13` высчитывается через побитовое "**И**" между двоичным **IP**-адресом (`11000000.10100111.00100110.00110110`) и маской (`11111111.11111000.00000000.00000000`): 
   
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729023711.png]]
   
   > `11000000.10100000.00000000.00000000` или `192.160.000.000`.
2. Перевод маски:
   
   - маска _`255.255.255.0`_:
     
     ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729024042.png]]
     
     > В префиксной записи: `/24`;
     > В Двоичной: `11111111.11111111.11111111.00000000`;
     
   - маска _`/15`_:
     
     ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729023832.png]]
     
     > В обычной: `255.254.0.0`;
     > В двоичной: `11111111.11111110.00000000.00000000`;
	- маска _`11111111.11111111.11111111.11110000`_:
	  
	  ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729024327.png]]
	  
	> В обычный: `255.255.255.240`;
	> В префиксной: `/28`.
3. Минимальный и максимальный хост в сети _`12.167.38.4`_ соответственно:
   
   - При маске `/8`: 
     > Min - `12.0.0.1`
     > Max - `12.255.255.254`
     
     ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729024439.png]]
     
   - При маске `11111111.11111111.00000000.00000000`: 
     > Min - `12.167.0.1`
	 > Max - `12.167.255.254`
     
     ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729024516.png]]
     
   - При маске `255.255.254.0`: 
     > Min - `12.167.38.1`
	 > Max - `12.167.39.254`
     
     ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729024630.png]]
     
   - При маске `/4`: 
     > Min - `0.0.0.1`
     > Max - `15.255.255.254`
     
     ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729024711.png]]

#### 1.2. localhost

К приложению, работающему на `localhost`:
1. можно обратиться по адресам:
- `127.0.0.2`;
- `127.1.0.1`.
> 	Т.к. это локальные адреса.
2. нельзя обратиться по адресам:
- `194.34.23.100`;
- `128.0.0.1`.
> 	Т.к. это глобальные адреса.


#### 1.3. Диапазоны и сегменты сетей

1. В качестве публичных можно использовать следующие адреса:
   - `134.43.0.2`;
   - `172.0.2.1`;
   - `192.172.0.1`;
   - `172.68.0.2`;
   - `192.169.168.1`.
2. В качестве частных можно использовать следующие адреса:
	- `10.0.0.45`;
	- `192.168.4.2`;
	- `172.20.250.4`;
	- `172.16.255.255` - широковещательный адрес для внутренней сети;
	- `10.10.10.10`.
3. У сети _`10.10.0.0/18`_ возможны следующие адреса шлюза из перечисленных:
	- `10.10.0.2`;
	- `10.10.10.10`.

---

## Part 2. Статическая маршрутизация между двумя машинами

Существующие сетевые интерфейсы:
- ws-1:
  
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729164929.png]]
- ws-2:
  
  ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729165026.png]]

У обеих машин одинаковый **IP**-адрес и **GW** для выхода в сеть через технологию **NAT** - `enp0s3`, в то время, как интерфейс для **внутренней сети** - `enp0s8` отключен (`DOWN`). Этим интерфейсам (`enp0s8`) необходимо задать **IP**-адреса и маски.

Отредактированный и работающий корректно файл 
`etc/netplan/00-installer-config.yaml`: 
1. **ws1 - _`192.168.100.10/16`_**:
   
  ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729201531.png]] 
2. **ws2 - _`172.24.116.8/12`_**:
   
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729201601.png]]

Вызов и вывод команды:
```
sudo netplan apply
```
1. **ws1**:
   
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729173855.png]]
2. **ws2**:
   
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729173813.png]]

---

#### 2.1. Добавление статического маршрута вручную

Ввод на **ws1**:
```shell
sudo ip r add 172.16.0.0/12 via 192.168.100.10 dev enp0s8
```
Ввод на **ws2**:
```shell
sudo ip r add 192.168.100.0/24 via 172.24.116.8 dev enp0s8
```
**ws1**:

![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729203117.png]]

**ws2**:

![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729202939.png]]

---

#### 2.2. Добавление статического маршрута с сохранением

Для обеих машин:
```
reboot
```

Изменить файл `etc/netplan/00-installer-config.yaml` и применить настройки
``` 
sudo netplan apply
``` 
1. **ws1**:
   
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729204520.png]]

2. **ws2**:
   
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729204348.png]]

**ping:**

1. **ws1**
   
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729204657.png]]
2. **ws2**
   
   ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240729204741.png]]

---

## Part 3. Утилита **iperf3**

#### 3.1. Скорость соединения

- 8 Mbps = 1 MB/s;
- 100 MB/s = 800000 Kbps;
- 1 Gbps = 1000 Mbps.

---

#### 3.2. Утилита **iperf3**

```
sudo apt install iperf3
```

Пусть машина **ws1** будет принимающим сервером:
``` 
ipref3 -s -f K
```
- `-s` - сервер
- `-f K` - вывод в килобайтах
 - ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240730135926.png]]

Тогда вторая машина (**ws2**) будет отправлять пакеты:
``` 
iperf3 -c 192.168.100.10 -f K
```
- ![[./assets_DO2_LinuxNetwork-1/Pasted image 20240730135852.png]]

В выводе утилиты:
- `Interval` - интервал;
- `Transfer` - объём переданных данных в интервал;
- `Bitrate` - пропускная способность;
- `Retr` (`Retransmits`) - количество повторных передач пакетов, которые были потеряны во время теста;
- `Cwnd` - размер окна. Показывает, сколько данных может быть отправлено до получения подтверждения от получателя.

Таким образом скорость соединения между **ws1** и **ws2**: ~`2.36` **GBits/s**.

---

## Part 4. Сетевой экран

#### 4.1. Утилита **iptables**

На **ws1** применим стратегию, когда в начале пишется запрещающее правило, а в конце пишется разрешающее правило. Далее для пунктов 4-5 я буду снимать и добавлять в код комментарии.

- Код:
  
   ![[Pasted image 20240730212607.png]]

   здесь сначала отчищаются все правила, 
   1. `#1` запрещается приём и отправка всех пакетов (не относится к пакетам, которые не назначаются текущему хосту);
   2. `#3` разрешаются подключения на стандартные порты **ssh** и **http** (**22** и **80**), а также разрешается полноценная работа для `loopback` адреса, чтобы не заблокировать локальные процессы;
   3. `#4` - запрет на ответ по протоколу **ICMP** (echo-reply), но разрешение на приём ответа и на отправку запроса (машина может пинговать, но не пинговаться);
   4. `#5` - разрешение на **ICMP**.

   `ping` `ws2`->`ws1` до применения `firewall.sh` `#4`:

   ![[Pasted image 20240730191249.png]]

   `ping` `ws2`->`ws1` после применения `firewall.sh` `#4`:

   ![[Pasted image 20240730191414.png]]

- Пункт 5:
  
  `ping` `ws2`->`ws1` после применения `firewall.sh` `#5`:

   ![[Pasted image 20240730191249.png]]

На **ws2** применим стратегию, когда в начале пишется разрешающее правило, а в конце пишется запрещающее правило. Далее для пунктов 4-5 я буду снимать и добавлять в код комментарии.

- Код:

   ![[Pasted image 20240730212636.png]]

   здесь сначала отчищаются все правила, 
   1. `#3` разрешаются подключения на стандартные порты **ssh** и **http** (22 и 80), а также разрешается полноценная работа для `loopback` адреса, чтобы не заблокировать локальные процессы; 
   2. `#4` - запрет на ответ по протоколу **ICMP** (echo-reply), но разрешение на приём ответа и на отправку запроса (машина может пинговать, но не пинговаться);
   3.  `#5` - разрешение на **ICMP**;
   4. `#1` запрещается приём и отправка всех пакетов (не относится к пакетам, которые не назначаются текущему хосту и пакетам, которые до этого были разрешены).

   `ping` `ws1`->`ws2` до применения `firewall.sh` `#4`:
   
   ![[Pasted image 20240730214454.png]]

   `ping` `ws1`->`ws2` после применения `firewall.sh` `#4`:

   ![[Pasted image 20240730214303.png]]

- Пункт 5:
  
  `ping` `ws1`->`ws2` после применения `firewall.sh` `#5`:
  
   ![[Pasted image 20240730214406.png]]

В моём случае в обоих вариантах используется стратегия "запрет+разрешение", несмотря на разный порядок команд. У 2х моих файлов нет логической разницы.

Разница между стратегиями "запрет+разрешение" и "разрешение+запрет":

1. **Стратегия "запрет+разрешение"**:
    - В этой стратегии по умолчанию все пакеты блокируются (запрещаются), и только затем добавляются конкретные правила для разрешения определенного трафика.
    - Это более безопасный подход, так как он минимизирует риск несанкционированного доступа. Сначала все запрещается, и только потом разрешается то, что явно указано.
    - Например, если вы хотите разрешить только SSH и HTTP, вы сначала устанавливаете политику по умолчанию на `DROP`, а затем добавляете правила для разрешения этих протоколов.
2. **Стратегия "разрешение+запрет"**:
    - В этой стратегии по умолчанию все пакеты разрешаются, и затем добавляются правила для блокировки нежелательного трафика.
    - Этот подход может быть менее безопасным, так как он позволяет потенциально опасному трафику проходить, пока не будет добавлено правило для его блокировки.
    - Например, если вы разрешаете весь трафик, а затем добавляете правила для блокировки определенных портов или протоколов, то в промежутке времени, пока правила не применены, система может быть уязвима.

---

#### 4.2. Утилита **nmap**

Запрещу ответы на `ping` на обеих машинах:

   ![[Pasted image 20240730215330.png]]

Пробую пинговать друг-друга:

   ![[Pasted image 20240730215501.png]]

Чтобы `nmap` мог отправлять различные запросы и принимать ответы, на атакующей машине необходимо отключить мешающий брандмауэр. Запускаю сканирование `nmap` с машины **ws2**:
```
sudo nmap -sC -T5 -p- -sT --min-rate 1000 192.168.100.10
```
![[Pasted image 20240730220555.png]]

Аналогично теперь с **ws1** (не забуду вернуть firewall) на **ws2**:
```
sudo nmap -sC -T5 -p- -sT --min-rate 1000 172.24.116.8
```
   ![[Pasted image 20240730221130.png]]