# Пользователи

---

## Создание пользователей

```bash  
useradd [опции] пользователь
```
- `-b` - базовый каталог для размещения домашней директории пользователя, по умолчанию **`/home`**.
- `-d` - Домашний каталог, в котором буду размешаться файлы пользователя.
- `-c` - комментарий к учётной записи.
- `-e` - дата, когда учётная запись будет заблокирована.
- `-f` - заблокировать учётную запись сразу после создания.
- `-g` - основная группа пользователя.

---

## Удаление пользователей
```bash
userdel [опции] пользователь
```
- `-f` - Принудительное удаление учётной записи и домашнего каталога пользователя, даже если он ещё находится в системе.
- `-r` - Удалить пользователя вместе с домашним каталогом и почтовым ящиком.
\
---

## Смена пароля
``` 
passed [опции] пользователь
```
- `-d` - удалить пароль пользователя (после этого он не сможет войти).
- `-e` - сделать пароль устаревшим.
- `i` - количество дней после того, как пароль устарел, по истечению которых пользователь не сможет войти в аккаунт, если не сменил пароль. 
- `l` - запретить пользователю входить в системы.
- `-n` - минимальное количество дней между сменами пароля.
- `-m` - максимальное количество дней, пока пароль можно использовать.

---

# Права доступа

![[Pasted image 20240714131049.png]]
Первый символ указывает на тип файла:  
- `d` - директория, 
- `-` обычный файл 
- `l` - символическая ссылка 
- `c` - устройство символьного ввода/вывода
- `b` - устройство блочного ввода/вывода
- `p` - FIFO - связь между процессами
- `s` - сокет

---

## Изменение прав доступа

**Изменить владельца:** назначить **`user`** владельцем **`file`** 
```
chown [опции] user file
```

**Изменить группу на `group` для `file`:** 
```
chgrp [опции] group file
```

**Изменить права доступа `rwx`:**
```
chmod [права] file
```
![[Pasted image 20240714132121.png]]
`$ chmod +x file` — Сделать файл исполняемым для всех
`$ chmod ug+w file` — Разрешить изменение файла для владельца и группы
`$ chmod o-w file` — Запретить запись остальным пользователям
`$ chmod ugo+rwx file` — Разрешить чтение, запись и исполнение для всех

---

# Группы

- Посмотреть группу - `$ sudo groups [имя пользователя]`
- Изменить группу на **`group1`** для файла **`file1`** - `$ chgrp [опции] group1 file1`
- Добавить пользователя в группу - `$ usrmod -a -G [имя группы] [имя пользователя]`
  
  Для того, чтобы пользователь мог выполнять команды от имени суперпользователя, его нужно добавить в группу “`sudo`”:
  ```
  $ usermod -aG sudo имя_пользователя
  ```
  - `-a` - add
  - `-G` - если у пользователя уже были группы, они отключатся от него

	Либо можно изменить файл `/etc/sudoers`
	![[Pasted image 20240714134115.png]]
	- `root ALL = (ALL:ALL) ALL` Данная строчка указывает на то, что пользователь root имеет неограниченные привилегии в системе
	- `%sudo ALL = (ALL:ALL) ALL` Пользователи в группе sudo имеют права на запуск любой программы
	  ![[Pasted image 20240714134318.png]]

---

# Конфигурирование файлов

---

## Файлы пользователей

`/etc/passwd` — текстовый файл, содержащий список учетных записей пользователей. В него можно добавить своего пользователя с отличным от **root** именем, но с тем же **UID**:  

![[etc-passwd.png]]

>— **Первое** поле отвечает за имя пользователя
— **Второе** поле содержит «x». На устаревших Linux-системах второе поле содержало зашифрованных пароль для аутентификации, но фактически, сейчас все Linux-системы хранят эту информацию в файле `/etc/shadow`. 
— **Третье** поле отвечает за числовой пользовательский идентификатор, связанный с конкретным пользователем 
— **Четвертое** поле ассоциирует этого пользователя с конкретной группой; скоро мы увидим, где определена группа 1000. 
— **Пятое** поле содержит текстовое описание аккаунта, в нашем случае это имя пользователя. 
— **Шестое** поле определяет домашний каталог пользователя 
— **Седьмое** устанавливает стартовую оболочку пользователя, которая будет автоматически запускаться когда пользователь входит в систему.

`/etc/shadow` - файл зашифрованных паролей, в котором хранится информация о паролях для учетных записей пользователей. В дополнение к этому файл `/etc/shadow` хранит дополнительную информацию о сроке действия пароля.
![[Pasted image 20240714135806.png]]
![[Pasted image 20240714135738.png]]

---

## Конфигурирование сети

- Узнать сетевые интерфейсы:
  ```
  dmesg | grep eth 
	```
- Информация о сетевом контролере:
  ```
  lspci | grep Ethernet
	```

**Утилита ip** - мощный инструмент для настройки сетевых интерфейсов, использующийся для включения или выключения интерфейсов, назначения или удаления адресов маршрутов, управления кэшем ARP и много другого.

- вывести статистику использования трафика сетевыми интерфесами:
  ``` 
  ip -s -h a
	```
	- `-h` - human-readable.
	- `-s` - статистика.
- вывести маршруты
  ``` 
  ip route
	```
	- или `ip r`.
- включение/остановка сетевого интерфейса:
  ``` 
  sudo ip link set [interface] down
	```
	``` 
  sudo ip link set [interface] up
	```
- сменить MAC адрес для сетевого интерфейса:
  ``` 
  sudo ip link set [interface] address [new MAC]
	```
- добавить новый сетевой интерфейс:
  ```
  sudo ip addr add [IP] dev [interface name]
	```
- мониторинг событий сетевых интерфесов
  ``` 
  ip monitor
	```
	- Это команда покажет удаление и добавление маршрутов, изменения IP-адресов, включение и выключение сетевых устройств и другие события. Это напоминает автоматически обновляемый `ip -s -h a`.


---

### Конфигурационные файлы сети

![[Pasted image 20240714154406.png]]
![[Pasted image 20240714155031.png]]
![[Pasted image 20240714155107.png]]
![[Pasted image 20240714155202.png]]

#### Изменение интерфесов (например на статические)

Внизу файла `/etc/network/interfaces` нужно прописать следующие правила:
``` 
auto eth0
iface eth0 inet static
address [IP]
netmask [mask]
gateway [gateway IP]
broadcast [broadcast]
```
При дальнейших изменениях стоит сверять файлы `/etc/network/interfaces` и `/etc/resolv.conf`.
В `/etc/resolv.conf` прописывается DNS адрес:
```
dns-nameserver [DNS IP, например: 8.8.8.8]
dns-nameserver [DNS IP, если нужен ещё 1]
```

**Перезапуск сервиса сети на Debian:**
```
sudo systemctl restart network.service
```
или
``` 
sudo service networking restart
```

---

# Мониторинг OS Linux
![[Pasted image 20240714141746.png]]

---

## htop - информация о процессах в реальном времени. выводит данные о потреблении системных ресурсов, останавливает и управляет процессами

![[Pasted image 20240714152027.png]]

- `-d [number]` - скорость обновления экрана в децисекундах (nubmer  = 10 = 1 сек)

---
## w - работающие в системе в ближайшее время пользователи

- `-u` - игнорировать имена пользователей при определении времени текущего процесса и времени CPU.
- `-s` - сокращённый формат вывода. Не выводи колонки JCPU и PCPU.
- `-f` - включить или выключить поле `from`, соответствующее имени удалённого хоста (remote hostname).
- `-i` - выводить в поле `from` IP-адрес вместо имени хоста, если это возможно.
- `-o` - выводить информацию в старом формате.

---

## df - сведения о файловой системе

- `-a` - включает фиктивные, дублированные, недоступные файловые системы.
- `-h` - human-readable - выводит размер в степени 1024.
- `-H` - выводит размер в степени 1000.
- `-l` - перечислить файловые системы.
- `-T` - выводит тип файловой системы.
  - `--type [TYPE]` - перечислить файловые системы конкретного типа.
  - `--exclude-type [TYPE]` - исключить файловые системы конкретного типа.

---

## du - сведения о дисковом пространстве

- `-a` - выводит весь объём всех файлов, а не только каталоги.
- `-b` - выводит действительные размеры в байтах.
- `-c` - выводит общий каталог.

---

## free - сколько свободной оперативной памяти доступно и достаточно ли свободной памяти для установки и запуска новых приложений

- `-b` - отображает вывод в байтах.
- `-k` - в килобайтах.
- `-m` - в мегабайтах.
- `-g` - в гигабайтах.
- `-h` - human-readable.
- `-w` - переключение вывода в расширенный режим, который обеспечивает вывод более 80 символов в строке.

---

## iostat - используется для мониторинга системной статистики ввода-вывода для устройств и разделов

- `-c` - отобразить только информацию об использовании процессора.
- `-d` - отобразить только информацию об использовании устройства.
- `-h` - human-readable.
- `-k` - вывести статистику в килобайтах.
- `-m` - вывести статистику в мегабайтах.
- `-p` - вывести статистику по устройству и всем его разделам.
- `-x` - вывести расширенную статистику.

---

## mpstat - вывод каждого имеющегося процесса

- `-A` - показывает всю информацию, которая может быть отображена с помощью команды `mpstat` о процессоре.
- `-P ALL` - вывод всех индивидуальных процессоров или ядер со статистикой
- `-P O` - для отображения статистики о конкретном CPU или ядре.

---

## vmstat - статистическая информация об оперативной памяти, дисках, ядра, переключении контекста и процессорах.

- `-a` - активная/неактивная память.
- `-f` - количество задач с момента загрузки.
- `-d` - статистика диска.
- `-D` - общая статистика диска.

---
















# Логирование

Все команды, выполняемые через **`sudo`** логируются в **`/var/log/auth.log`**
