## Способы аутентификации в Wi-Fi сетях

Глобально существует всего 2 модели аутентификации:
1. Открытая
2. На основе четырехстороннего рукопожатия

Рассмотрим их по отдельности.

### Открытая аутентификация

Честно говоря, аутентификацией эту модель можно назвать лишь формально, так как весь процесс, по своей сути, состоит из оповещения клиентом точки доступа о подключении и ее положительного ответа.

Выглядит эта модель примерно так:
![[Аутентификация в сети.png]]
Как видно - ничего сложного. Безопасность у такой схемы, естественно, никакая, ведь процесс аутентификации может пройти абсолютно любой клиент.

Когда же вы отключаетесь от сети (например, по причине смены пароля), роутер отправляет вам один из так называемых **Management** фреймов.

> **Management frames** - особые сообщения, передающие важную служебную информацию.

Одним из таких фреймов и является **Deauthentication frame**, который позволяет станции сообщать клиенту об его отключении по той или иной причине.

### Аутентификация на основе четырехстороннего рукопожатия

В данной модели и точка, и клиент проходят четырехэтапный процесс аутентификации, завязанный на знании ключа.

Выглядит эта схема так:

![[Аутентификация на основе четырёхстороннего рукопожатия.png]]

> Несмотря на то, что в ходе обмена каждая из сторон должна удостовериться в правильности общего ключа, полностью между ними он никогда не передается. Вместо этого по каналу связи передается лишь его производная (не в математичеком смысле) - сессионные ключи, полученные с помощью AES / RC4.

## Шифрование и Wi-Fi

Как вы понимаете, оставлять сеть открытой для всех желающих - довольно плохая затея (кроме ряда случаев), так что появление шифрования в Wi-Fi сетях было лишь делом времени.

Как и в прошлом пункте, глобально существует 2 технологии:

1. WEP
2. WPA

Также рассмотрим их подробнее.

### WEP

**WEP** - технология, представленная в 1997 и ставшая первой попыткой как-либо защитить беспроводные сети.

Работает она достаточно просто: все данные, передающиеся по сети, зашифрованы с помощью предварительного общего ключа (**PSK**), общего для всех устройств в сети.

Процесс аутентификации с использованием данной системы происходил следующим образом:

1. Клиент посылает аутентификационный запрос.
2. Точка доступа отвечает незашифрованным _challenge_ текстом.
3. Клиент шифрует сообщение известным ему _preshared key_ и передает его обратно.
4. Точка доступа пробует расшифровать сообщение, и если все удачно - аутентифицирует клиента.

Основной целью WEP было реализовать защиту от **MITM** ("Man-in-the-middle", она же "человек посередине"), но уже в 2004 году она была признана "устаревшей" и небезопасной, в связи с недостатками самого алгоритма шифрования.

> ℹ️ Было несколько попыток улучшить **WEP**, которые получили названия **WEP2**, **WEPplus** и **Dynamic WEP**, но кардинально они ситуацию не поменяли, и сейчас **WEP** практически невозможно встретить в реальной жизни.

### WPA

Когда **WEP** в плане безопасности стало недостаточно, появился **WPA**.

На данный момент существует 3 версии **WPA**:

1. **WPA**
2. **WPA2**
3. **WPA3**

Начнем с первой версии, которая сейчас уже практически не используется.

#### WPA

Первая версия **WPA** появилась в 2003 году как замена **WEP**, усовершенствовав обработку ключей безопасности и авторизации пользователей. Основным нововведением стало то, что вместо постоянного ключа, предоставляемого всем авторизованным системам, **WPA** стала предоставлять **TKIP** (Temporal Key Integrity Protocol, протокол целостности временного ключа), который динамически меняет ключ, используемый системами.

Для генерации этого ключа обеим системам (клиенту и точке доступа) нужна следующая информация: `PTK = PRF (PMK + Anonce + SNonce + Mac (Access point)+ Mac (Client device))`

> ℹ️ Еще одним важным улучшением стало увеличение длины ключа до 256-битных ключей, что значительно надежнее 64 и 128-битных ключей, используемых протоколом **WEP**.

Стоит отметить, что данная технология стала переходной между **WEP** и **WPA2**, так как все еще основывалась на шифровании **RC4**, что позволяло старым сетевым картам поддерживать соединение с таким протоколом защиты.

Тем не менее, в скором времени и в **WPA** нашлось достаточно многих уязвимостей, что привело к созданию **WPA2**.

#### WPA2

Протокол **WPA2** появился в 2004 году, став заменой **WPA**. Данная система основана на механизме **RSN** и может быть использован в двух режимах:

1. **Персональный режим** (**WPA2-PSK**) - в данном режиме система использует общий пароль доступа. Обычно применяется в сетях общего назначения.
2. **Корпоративный режим** (**WPA2-EAP**) - данный режим чаще всего используется для коммерческого использования. В данном случае аутентификация проходит через специальный сервер.

В обоих режимах используется протокол **CCMP**, основанный на **AES**, что обеспечивает проверку подлинности и целостности сообщения. Именно это и делает **WPA2** более надежным и защищенным, чем **WPA**.

> ℹ️ На данный момент это самый часто используемый протокол безопасности, который вы можете встретить практически везде (например, в той сети, к которой подключен ваш ПК или телефон).

Можно ли его взломать? При определенных обстоятельствах (которые, к слову, встречаются довольно часто) - да, за пару минут.

#### WPA3

Последней на данный момент версии протокола **WPA**. Что же появилось нового?

На самом деле, немало:

1. **Индивидуальное шифрование данных** - для регистрации нового пользователя больше не нужно использовать общий пароль
2. **Одновременная аутентификация равных**, заменившая **PSK** и делающая атаку **KRACK** невозможной.
3. **Защита от брутфорса пароля** путем необходимости физического присутствия рядом с точкой доступа.

> ℹ️ Хоть и представлена данная технология была в 2018 году, большинство устройств все еще используют **WPA2**, в силу дешевизны и обратной совместимости.


Подробнее о всех нововведениях можно почитать [здесь](https://habr.com/ru/articles/424925/).